var l=Object.defineProperty;var o=Object.getOwnPropertySymbols;var d=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable;var a=(n,e,t)=>e in n?l(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,r=(n,e)=>{for(var t in e||(e={}))d.call(e,t)&&a(n,t,e[t]);if(o)for(var t of o(e))c.call(e,t)&&a(n,t,e[t]);return n};class h{constructor(e={}){this.config=r({cdnPrefix:"https://cdn.jsdelivr.net/gh/diligent-ground-zero/the-wave@2.0/music/",songs:[{name:"Have it Your Way",fileName:"Vibe 01 - Have It Your Way.mp3"},{name:"Fire Inside",fileName:"Vibe 02 - Fire inside.mp3"},{name:"Luminious Dream",fileName:"Vibe 03 - Luminous Dream.mp3"},{name:"You Color Me In",fileName:"Vibe 04 - You Color Me In.mp3"}]},e),this.state={audioContext:null,isAudioContextInitialized:!1,songIndex:0,isLoading:!1},this.elements=this.initializeElements(),this.boundHandlers=this.initializeBoundHandlers()}initializeElements(){const e={container:document.getElementById("music-container"),playBtn:document.getElementById("play"),prevBtn:document.getElementById("prev"),nextBtn:document.getElementById("next"),audio:document.getElementById("audio"),progress:document.getElementById("progress"),progressContainer:document.getElementById("progress-container"),title:document.getElementById("title"),currTime:document.querySelector("#currTime"),playIcon:document.querySelector(".play-img"),pauseIcon:document.querySelector(".pause-img")};if(!e.title||!e.audio)throw new Error("Required elements not found");return e}initializeBoundHandlers(){return{updateProgress:this.updateProgress.bind(this),setProgress:this.setProgress.bind(this),handleTimeUpdate:this.updateCurrentTime.bind(this),handlePlayClick:this.togglePlay.bind(this)}}ensureAudioContext(){return this.state.audioContext||(this.state.audioContext=new(window.AudioContext||window.webkitAudioContext)),this.state.audioContext}async loadSong(e){try{this.state.isLoading=!0,this.elements.title.innerText=e.name,this.elements.audio.src=this.config.cdnPrefix+e.fileName,this.elements.audio.load(),await new Promise(t=>{this.elements.audio.oncanplaythrough=t}),this.state.isLoading=!1,this.state.isAudioContextInitialized&&await this.playSong()}catch(t){console.error("Error loading song:",t),this.state.isLoading=!1}}async playSong(){if(!this.state.isLoading)try{this.elements.container.classList.add("play"),this.elements.playIcon.style.display="none",this.elements.pauseIcon.style.display="block";const e=this.ensureAudioContext();e.state==="suspended"&&await e.resume(),await this.elements.audio.play()}catch(e){console.error("Error playing song:",e)}}pauseSong(){this.elements.container.classList.remove("play"),this.elements.playIcon.style.display="block",this.elements.pauseIcon.style.display="none",this.elements.audio.pause()}async prevSong(){this.state.songIndex=(this.state.songIndex-1+this.config.songs.length)%this.config.songs.length,await this.loadSong(this.config.songs[this.state.songIndex]),this.playSong()}async nextSong(){this.state.songIndex=(this.state.songIndex+1)%this.config.songs.length,await this.loadSong(this.config.songs[this.state.songIndex]),this.playSong()}updateProgress(e){const{duration:t,currentTime:i}=e.srcElement,s=i/t*100;this.elements.progress.style.width=`${s}%`}setProgress(e){const t=this.elements.progressContainer.clientWidth,i=e.offsetX,s=this.elements.audio.duration;this.elements.audio.currentTime=i/t*s}updateCurrentTime(e){const{currentTime:t}=e.srcElement,i=Math.floor(t/60).toString().padStart(2,"0"),s=Math.floor(t%60).toString().padStart(2,"0");this.elements.currTime.innerHTML=`${i}:${s}`}togglePlay(){this.elements.container.classList.contains("play")?this.pauseSong():this.playSong()}prefetchSongs(){this.config.songs.forEach(e=>{const t=document.createElement("link");t.href=this.config.cdnPrefix+e.fileName,t.as="audio",t.rel="prefetch",document.head.appendChild(t)})}attachEventListeners(){this.elements.prevBtn.addEventListener("click",()=>this.prevSong()),this.elements.nextBtn.addEventListener("click",()=>this.nextSong()),this.elements.audio.addEventListener("timeupdate",this.boundHandlers.updateProgress),this.elements.progressContainer.addEventListener("click",this.boundHandlers.setProgress),this.elements.audio.addEventListener("ended",()=>this.nextSong()),this.elements.audio.addEventListener("timeupdate",this.boundHandlers.handleTimeUpdate),this.elements.playBtn.addEventListener("click",this.boundHandlers.handlePlayClick)}initialize(){try{return this.prefetchSongs(),this.loadSong(this.config.songs[this.state.songIndex]),this.attachEventListeners(),{ensureAudioContext:this.ensureAudioContext.bind(this),playSong:this.playSong.bind(this),pauseSong:this.pauseSong.bind(this),audio:this.elements.audio}}catch(e){throw console.error("Failed to initialize music player:",e),e}}}document.addEventListener("DOMContentLoaded",async()=>{try{const n=new h,{playSong:e}=n.initialize();let t=!1;document.addEventListener("click",async()=>{if(!t)try{await e(),t=!0}catch(i){console.error("Error initializing audio on click:",i)}},{once:!0})}catch(n){console.error("Failed to initialize music player:",n)}});
